<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ash.server.mapper.OrderDetailedMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.ash.server.pojo.OrderDetailed">
        <id column="order_detailed_id" property="orderDetailedId"/>
        <result column="order_id" property="orderId"/>
        <result column="commodity_id" property="commodityId"/>
        <result column="order_detailed_num" property="orderDetailedNum"/>
        <result column="order_detailed_price" property="orderDetailedPrice"/>
        <result column="order_detailed_total" property="orderDetailedTotal"/>
    </resultMap>

    <resultMap id="OrderDetailInfo" type="com.ash.server.pojo.OrderDetailed" extends="BaseResultMap">
        <association property="commodity" javaType="com.ash.server.pojo.Commodity">
            <id column="commodity_id" property="commodityId"/>
            <result column="commodity_image" property="commodityImage"/>
            <result column="commodity_name" property="commodityName"/>
            <result column="commodity_price" property="commodityPrice"/>
            <result column="commodity_discount" property="commodityDiscount"/>
            <result column="commodity_describe" property="commodityDescribe"/>
        </association>
    </resultMap>
    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        order_detailed_id
        , order_id, commodity_id, commodity_category_id, order_detailed_num, order_detailed_price
    </sql>

    <!--  获取所有订单详情（分页）-->
    <select id="getOrderDetailedByPage" resultMap="OrderDetailInfo">
        SELECT
        od.*,
        o.order_id,
        c.commodity_name
        FROM
        h_order o,
        h_order_detailed od,
        h_commodity c
        WHERE
        o.order_id = od.order_id
        AND od.commodity_id = c.commodity_id
        <if test="null!=orderDetailed.orderId">
            AND od.order_id=#{orderDetailed.orderId}
        </if>
        <if test="null!=orderDetailed.commodity.commodityName and ''!=orderDetailed.commodity.commodityName">
            AND c.commodity_name LIKE CONCAT('%',#{orderDetailed.commodity.commodityName},'%')
        </if>
        ORDER BY o.order_id
    </select>
    <select id="getOrderDetailedByOrderId" resultMap="OrderDetailInfo">
        SELECT od.*,
               o.order_id,
               c.commodity_name
        FROM h_order o,
             h_order_detailed od,
             h_commodity c
        WHERE o.order_id = od.order_id
          AND od.commodity_id = c.commodity_id
          AND o.order_id = #{orderId}
        ORDER BY o.order_id
    </select>

</mapper>
